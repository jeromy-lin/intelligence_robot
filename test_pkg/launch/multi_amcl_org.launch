<launch>
  <!-- 定義機器人參數 -->
  <arg name="robot1_namespace" default="turtlebot1" />
  <arg name="robot2_namespace" default="turtlebot2" />
  <arg name="scan_topic" default="scan" />
  <arg name="use_sim_time" default="true" />

  <!-- 定義模擬時間 -->
  <param name="use_sim_time" value="$(arg use_sim_time)" />
  
  
    <!-- 設置 tf_prefix 參數 -->
  <arg name="tf_prefix" default=""/>
  
  <!-- 設定 AMCL 節點的參數 -->
  <node name="amcl" pkg="amcl" type="amcl" output="screen">
    <param name="tf_prefix" value="$(arg tf_prefix)"/>
    <!-- 其他參數配置 -->
  </node>
  

  <!-- AMCL 節點配置 for turtlebot1 -->
  <group ns="$(arg robot1_namespace)">
    <arg name="initial_pose_x" default="-2.0" />
    <arg name="initial_pose_y" default="-0.5" />
    <arg name="initial_pose_a" default="0.0" />
    <node pkg="amcl" type="amcl" name="amcl" output="screen">
      <!-- AMCL 配置參數 -->
      <param name="use_sim_time" value="$(arg use_sim_time)" />
      <param name="min_particles" value="500" />
      <param name="max_particles" value="3000" />
      <param name="kld_err" value="0.02" />
      <param name="update_min_d" value="0.2" />
      <param name="update_min_a" value="0.2" />
      <param name="resample_interval" value="1" />
      <param name="transform_tolerance" value="0.5" />
      <param name="recovery_alpha_slow" value="0.00" />
      <param name="recovery_alpha_fast" value="0.00" />
      <param name="laser_max_range" value="3.5" />
      <param name="laser_max_beams" value="180" />
      <param name="laser_z_hit" value="0.5" />
      <param name="laser_z_short" value="0.05" />
      <param name="laser_z_max" value="0.05" />
      <param name="laser_z_rand" value="0.5" />
      <param name="laser_sigma_hit" value="0.2" />
      <param name="laser_lambda_short" value="0.1" />
      <param name="laser_likelihood_max_dist" value="2.0" />
      <param name="laser_model_type" value="likelihood_field" />
      <param name="odom_model_type" value="diff" />
      <param name="odom_alpha1" value="0.1" />
      <param name="odom_alpha2" value="0.1" />
      <param name="odom_alpha3" value="0.1" />
      <param name="odom_alpha4" value="0.1" />
      <param name="odom_frame_id" value="odom" />
      <param name="base_frame_id" value="base_footprint" />
      <param name="global_frame_id" value="map" />
      <param name="initial_pose_x" value="$(arg initial_pose_x)" />
      <param name="initial_pose_y" value="$(arg initial_pose_y)" />
      <param name="initial_pose_a" value="$(arg initial_pose_a)" />

      <!-- Remap topics -->
      <remap from="scan" to="$(arg robot1_namespace)/$(arg scan_topic)" />
    </node>
  </group>

  <!-- AMCL 節點配置 for turtlebot2 -->
  <group ns="$(arg robot2_namespace)">
    <arg name="initial_pose_x" default="2.0" />
    <arg name="initial_pose_y" default="0.5" />
    <arg name="initial_pose_a" default="0.0" />
    <node pkg="amcl" type="amcl" name="amcl" output="screen">
      <!-- AMCL 配置參數 -->
      <param name="use_sim_time" value="$(arg use_sim_time)" />
      <param name="min_particles" value="500" />
      <param name="max_particles" value="3000" />
      <param name="kld_err" value="0.02" />
      <param name="update_min_d" value="0.2" />
      <param name="update_min_a" value="0.2" />
      <param name="resample_interval" value="1" />
      <param name="transform_tolerance" value="0.5" />
      <param name="recovery_alpha_slow" value="0.00" />
      <param name="recovery_alpha_fast" value="0.00" />
      <param name="laser_max_range" value="3.5" />
      <param name="laser_max_beams" value="180" />
      <param name="laser_z_hit" value="0.5" />
      <param name="laser_z_short" value="0.05" />
      <param name="laser_z_max" value="0.05" />
      <param name="laser_z_rand" value="0.5" />
      <param name="laser_sigma_hit" value="0.2" />
      <param name="laser_lambda_short" value="0.1" />
      <param name="laser_likelihood_max_dist" value="2.0" />
      <param name="laser_model_type" value="likelihood_field" />
      <param name="odom_model_type" value="diff" />
      <param name="odom_alpha1" value="0.1" />
      <param name="odom_alpha2" value="0.1" />
      <param name="odom_alpha3" value="0.1" />
      <param name="odom_alpha4" value="0.1" />
      <param name="odom_frame_id" value="odom" />
      <param name="base_frame_id" value="base_footprint" />
      <param name="global_frame_id" value="map" />
      <param name="initial_pose_x" value="$(arg initial_pose_x)" />
      <param name="initial_pose_y" value="$(arg initial_pose_y)" />
      <param name="initial_pose_a" value="$(arg initial_pose_a)" />

      <!-- Remap topics -->
      <remap from="scan" to="$(arg robot2_namespace)/$(arg scan_topic)" />
    </node>
  </group>
</launch>

